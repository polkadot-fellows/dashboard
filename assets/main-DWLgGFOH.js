import{scanRGBABuffer as R,ZBarConfigType as l,ZBarSymbolType as i,getDefaultScanner as E}from"https://cdn.jsdelivr.net/npm/@undecaf/zbar-wasm@0.9.16/dist/main.js";function B(o,e,n,a){return new(n||(n=Promise))((function(r,c){function g(s){try{d(a.next(s))}catch(m){c(m)}}function h(s){try{d(a.throw(s))}catch(m){c(m)}}function d(s){var m;s.done?r(s.value):(m=s.value,m instanceof n?m:new n((function(A){A(m)}))).then(g,h)}d((a=a.apply(o,[])).next())}))}class t{constructor(e,n=l.ZBAR_CFG_ENABLE,a=1){this.symbolType=e,this.configType=n,this.number=a,this.configSteps=[this]}static register(e,n,a=n.symbolType){return t.formatsToConfigs[e]=n,t.typesToFormats[a]=t.typesToFormats[a]||e,n}static formats(){return Object.keys(t.formatsToConfigs)}static toFormat(e){return t.typesToFormats[e]}static configure(e,n){var a;(a=t.formatsToConfigs[n])===null||a===void 0||a.configSteps.forEach((r=>e.setConfig(r.symbolType,r.configType,r.number)))}add(e){return this.configSteps.push(e),this}}var u;t.formatsToConfigs={},t.typesToFormats={},t.register("codabar",new t(i.ZBAR_CODABAR)),t.register("code_39",new t(i.ZBAR_CODE39)),t.register("code_93",new t(i.ZBAR_CODE93)),t.register("code_128",new t(i.ZBAR_CODE128)),t.register("databar",new t(i.ZBAR_DATABAR)),t.register("databar_exp",new t(i.ZBAR_DATABAR_EXP)),t.register("ean_2",new t(i.ZBAR_EAN2)),t.register("ean_5",new t(i.ZBAR_EAN5)),t.register("ean_8",new t(i.ZBAR_EAN8)),t.register("ean_13",new t(i.ZBAR_EAN13)),t.register("ean_13+2",new t(i.ZBAR_EAN13)).add(new t(i.ZBAR_EAN2)),t.register("ean_13+5",new t(i.ZBAR_EAN13)).add(new t(i.ZBAR_EAN5)),t.register("isbn_10",new t(i.ZBAR_ISBN10)).add(new t(i.ZBAR_EAN13)),t.register("isbn_13",new t(i.ZBAR_ISBN13)).add(new t(i.ZBAR_EAN13)),t.register("isbn_13+2",new t(i.ZBAR_ISBN13)).add(new t(i.ZBAR_EAN13)).add(new t(i.ZBAR_EAN2)),t.register("isbn_13+5",new t(i.ZBAR_ISBN13)).add(new t(i.ZBAR_EAN13)).add(new t(i.ZBAR_EAN5)),t.register("itf",new t(i.ZBAR_I25)),t.register("qr_code",new t(i.ZBAR_QRCODE)),t.register("sq_code",new t(i.ZBAR_SQCODE)),t.register("upc_a",new t(i.ZBAR_UPCA)).add(new t(i.ZBAR_EAN13)),t.register("upc_e",new t(i.ZBAR_UPCE)).add(new t(i.ZBAR_EAN13)),(function(o){o[o.UNKNOWN=-1]="UNKNOWN",o[o.UPRIGHT=0]="UPRIGHT",o[o.ROTATED_RIGHT=1]="ROTATED_RIGHT",o[o.UPSIDE_DOWN=2]="UPSIDE_DOWN",o[o.ROTATED_LEFT=3]="ROTATED_LEFT"})(u||(u={}));class w{}const y=(()=>{try{return new OffscreenCanvas(1,1).getContext("2d")instanceof OffscreenCanvasRenderingContext2D}catch{return!1}})();class f{constructor(e={}){if(e.formats!==void 0){if(!Array.isArray(e.formats)||!e.formats.length)throw new TypeError(`Barcode formats should be a non-empty array of strings but are: ${JSON.stringify(e)}`);const n=e.formats.filter((a=>!t.formats().includes(a)));if(n.length)throw new TypeError(`Unsupported barcode format(s): ${n.join(", ")}`)}this.formats=e.formats||t.formats(),this.zbarConfig=e.zbar||new w}static getSupportedFormats(){return Promise.resolve(t.formats())}detect(e){f.validate(e);const n=f.intrinsicDimensions(e);if(n.width===0||n.height===0)return Promise.resolve([]);try{return Promise.all([this.toImageData(e),this.getScanner()]).then((a=>{const r=a[0],c=a[1];return this.zbarConfig.enableCache!==void 0&&c.enableCache(this.zbarConfig.enableCache),R(r.data,r.width,r.height,c)})).then((a=>a.map((r=>this.toBarcodeDetectorResult(r)))))}catch(a){return Promise.reject(a)}}getScanner(){return new Promise(((e,n)=>B(this,void 0,void 0,(function*(){if(!this.scanner){const a=yield E();this.formats.length>0&&(a.setConfig(i.ZBAR_NONE,l.ZBAR_CFG_ENABLE,0),this.formats.forEach((r=>t.configure(a,r)))),this.scanner=a}e(this.scanner)}))))}toImageData(e){const n=a=>{const r=f.intrinsicDimensions(a);this.canvas&&this.canvas.width===r.width&&this.canvas.height===r.height||(this.canvas=(function(h,d){if(y)return new OffscreenCanvas(h,d);{const s=document.createElement("canvas");return s.width=h,s.height=d,s}})(r.width,r.height));const c=this.canvas,g=c.getContext("2d");return g.drawImage(a,0,0),g.getImageData(0,0,c.width,c.height)};if(e instanceof ImageData)return Promise.resolve(e);if(e instanceof Blob){if(typeof createImageBitmap=="function")return createImageBitmap(e).then((a=>n(a)));{const a=document.createElement("img");return a.src=URL.createObjectURL(e),a.decode().then((()=>n(a))).finally((()=>URL.revokeObjectURL(a.src)))}}return f.isRenderingContext(e)?Promise.resolve(e.getImageData(0,0,e.canvas.width,e.canvas.height)):Promise.resolve(n(e))}toBarcodeDetectorResult(e){const n={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};return e.points.forEach((a=>{n.minX=Math.min(n.minX,a.x),n.maxX=Math.max(n.maxX,a.x),n.minY=Math.min(n.minY,a.y),n.maxY=Math.max(n.maxY,a.y)})),{format:t.toFormat(e.type),rawValue:e.decode(this.zbarConfig.encoding),orientation:e.orientation,quality:e.quality,boundingBox:DOMRectReadOnly.fromRect({x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY}),cornerPoints:[{x:n.minX,y:n.minY},{x:n.maxX,y:n.minY},{x:n.maxX,y:n.maxY},{x:n.minX,y:n.maxY}]}}static validate(e){if(!f.isPolyfillImageBitmapSource(e))throw new TypeError("BarcodeDetector.detect() argument is not an ImageBitmapSource");if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement&&!e.complete)throw new DOMException(`Invalid HTMLImageElement.complete state: ${e.complete}`,"InvalidStateError");if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement&&[HTMLMediaElement.HAVE_NOTHING,HTMLMediaElement.HAVE_METADATA].includes(e.readyState))throw new DOMException(`Invalid HTMLVideoElement.readyState: ${e.readyState}`,"InvalidStateError");return!0}static isRenderingContext(e){return typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D}static isPolyfillImageBitmapSource(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof SVGImageElement<"u"&&e instanceof SVGImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas||typeof VideoFrame<"u"&&e instanceof VideoFrame||f.isRenderingContext(e)||e instanceof ImageData||e instanceof Blob||e&&(e.width==0||e.height==0)}static intrinsicDimensions(e){return f.isRenderingContext(e)&&(e=e.canvas),{width:Number(e.naturalWidth||e.videoWidth||e.codedWidth||e.clientWidth||e.width),height:Number(e.naturalHeight||e.videoHeight||e.codedHeight||e.clientHeight||e.height)}}}const _="@undecaf/zbar-wasm",T="0.9.16",C="https://cdn.jsdelivr.net/npm/@undecaf/zbar-wasm@0.9.16";export{f as BarcodeDetectorPolyfill,u as Orientation,_ as ZBAR_WASM_PKG_NAME,C as ZBAR_WASM_REPOSITORY,T as ZBAR_WASM_VERSION,w as ZBarConfig};
